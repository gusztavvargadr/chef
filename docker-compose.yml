version: "3"

services:
  chef-core-linux:
    image: gusztavvargadr/chef-core:linux-${LINUX_VARIANT}-${LINUX_VERSION}
    build:
      context: ./
      dockerfile: ./build/docker/linux/chef-core.Dockerfile
      args:
        - LINUX_VARIANT
        - LINUX_VERSION
    volumes:
      - ./:/opt/docker/work/
    entrypoint: echo
    command: chef-core

  chef-client-linux:
    image: gusztavvargadr/chef-client:linux-${LINUX_VARIANT}-${LINUX_VERSION}
    build:
      context: ./
      dockerfile: ./build/docker/linux/chef-client.Dockerfile
      args:
        - LINUX_VARIANT
        - LINUX_VERSION
        - CHEF_CLIENT_VERSION
    volumes:
      - ./:/opt/docker/work/
    entrypoint: chef-client
    command: --version

  chef-workstation-linux:
    image: gusztavvargadr/chef-workstation:linux-${LINUX_VARIANT}-${LINUX_VERSION}
    build:
      context: ./
      dockerfile: ./build/docker/linux/chef-workstation.Dockerfile
      args:
        - LINUX_VARIANT
        - LINUX_VERSION
        - CHEF_WORKSTATION_VERSION
    volumes:
      - ./:/opt/docker/work/
    entrypoint: chef
    command: --version

  chef-cookbook-lint-linux:
    image: gusztavvargadr/chef-workstation:linux
    volumes:
      - ./:/opt/docker/work/
    entrypoint: ./build/chef/linux/chef-workstation.cookbook-lint.sh
    command: hello-world

  chef-cookbook-test-linux:
    image: gusztavvargadr/chef-workstation:linux
    volumes:
      - ./:/opt/docker/work/
    entrypoint: ./build/chef/linux/chef-workstation.cookbook-test.sh
    command: hello-world

  chef-policy-build-linux:
    image: gusztavvargadr/chef-workstation:linux
    volumes:
      - ./:/opt/docker/work/
    entrypoint: ./build/chef/linux/chef-workstation.policy-build.sh
    command: hello-world

  chef-policy-run-linux:
    image: gusztavvargadr/chef-client:linux
    volumes:
      - ./:/opt/docker/work/
    entrypoint: ./build/chef/linux/chef-client.policy-run.sh
    command: hello-world

  chef-core-windows:
    image: gusztavvargadr/chef-core:windows-${WINDOWS_VARIANT}-${WINDOWS_VERSION}
    build:
      context: ./
      dockerfile: ./build/docker/windows/chef-core.Dockerfile
      args:
        - WINDOWS_VARIANT
        - WINDOWS_VERSION
    volumes:
      - ./:C:/opt/docker/work/
    entrypoint: cmd
    command: /c echo chef-core

  chef-client-windows:
    image: gusztavvargadr/chef-client:windows-${WINDOWS_VARIANT}-${WINDOWS_VERSION}
    build:
      context: ./
      dockerfile: ./build/docker/windows/chef-client.Dockerfile
      args:
        - WINDOWS_VARIANT
        - WINDOWS_VERSION
        - CHEF_CLIENT_VERSION
    volumes:
      - ./:C:/opt/docker/work/
    entrypoint: chef-client.bat
    command: --version

  chef-workstation-windows:
    image: gusztavvargadr/chef-workstation:windows-${WINDOWS_VARIANT}-${WINDOWS_VERSION}
    build:
      context: ./
      dockerfile: ./build/docker/windows/chef-workstation.Dockerfile
      args:
        - WINDOWS_VARIANT
        - WINDOWS_VERSION
        - CHEF_WORKSTATION_VERSION
    volumes:
      - ./:C:/opt/docker/work/
    entrypoint: chef-cli.bat
    command: --version

  chef-cookbook-lint-windows:
    image: gusztavvargadr/chef-workstation:windows
    volumes:
      - ./:C:/opt/docker/work/
    entrypoint: powershell -File ./build/chef/windows/chef-workstation.cookbook-lint.ps1
    command: hello-world

  chef-cookbook-test-windows:
    image: gusztavvargadr/chef-workstation:windows
    volumes:
      - ./:C:/opt/docker/work/
    entrypoint: powershell -File ./build/chef/windows/chef-workstation.cookbook-test.ps1
    command: hello-world

  chef-policy-build-windows:
    image: gusztavvargadr/chef-workstation:windows
    volumes:
      - ./:C:/opt/docker/work/
    entrypoint: powershell -File ./build/chef/windows/chef-workstation.policy-build.ps1
    command: hello-world

  chef-policy-run-windows:
    image: gusztavvargadr/chef-client:windows
    volumes:
      - ./:C:/opt/docker/work/
    entrypoint: powershell -File ./build/chef/windows/chef-client.policy-run.ps1
    command: hello-world
