parameters:
  cookbooks: [ 'docker', 'windows' ]

stages:
  - stage: commit
    displayName: Commit

    jobs:
      - ${{ each cookbook in parameters.cookbooks }}:
        - job: test_${{ cookbooks }}
          displayName: Test ${{ cookbook }}

          pool:
            name: Default
            demands:
              - AZP_AGENT_CHEF

          workspace:
            clean: all

          steps:
            - checkout: self
              submodules: recursive

            - script: |
                chef --version
              displayName: Init

            - script: |
                cd ./samples/cookbooks/${{ cookbook }}_test
                pwd

                kitchen list
              displayName: Test
