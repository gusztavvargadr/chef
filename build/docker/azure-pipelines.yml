trigger:
  branches:
    include:
      - '*'
  paths:
    include:
      - build/docker
pr: none

variables:
  isPublishEnabled: $[eq(variables['Build.SourceBranch'], 'refs/heads/master')]

stages:
  - template: ./azure-pipelines.stages.yml
    parameters:
      configurations:
        - name: chef-core
          platforms:
            - name: windows
              variant: servercore
              version: 'ltsc2022'
              isolation: default

            - name: windows
              variant: servercore
              version: 'ltsc2019'
              isolation: hyperv

            - name: linux
              variant: ubuntu
              version: '20.04'
              isolation: default

        - name: chef-client
          platforms:
            - name: windows
              variant: servercore
              version: 'ltsc2022'
              isolation: default

            - name: windows
              variant: servercore
              version: 'ltsc2019'
              isolation: hyperv

            - name: linux
              variant: ubuntu
              version: '20.04'
              isolation: default
          dependsOn: chef-core

        - name: chef-workstation
          platforms:
            - name: windows
              variant: servercore
              version: 'ltsc2022'
              isolation: default

            - name: windows
              variant: servercore
              version: 'ltsc2019'
              isolation: hyperv

            - name: linux
              variant: ubuntu
              version: '20.04'
              isolation: default
          dependsOn: chef-core
