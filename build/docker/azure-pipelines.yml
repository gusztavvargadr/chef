trigger:
  branches:
    include:
      - '*'
  paths:
    include:
      - docker-compose.yml
      - .dockerignore
      - .env.windows-servercore-1809
      - .env.linux-ubuntu-20.04
      - build/docker
      - build/chef
      - lib
pr: none

variables:
  isPublishEnabled: $[eq(variables['Build.SourceBranch'], 'refs/heads/master')]

stages:
  - template: ./azure-pipelines.stages.yml
    parameters:
      configurations:
        - name: chef-core
          platforms:
            - name: windows
              variant: servercore
              version: "1809"

            - name: linux
              variant: ubuntu
              version: "20.04"

        - name: chef-client
          platforms:
            - name: windows
              variant: servercore
              version: "1809"

            - name: linux
              variant: ubuntu
              version: "20.04"
          dependsOn: chef-core

        - name: chef-workstation
          platforms:
            - name: windows
              variant: servercore
              version: "1809"

            - name: linux
              variant: ubuntu
              version: "20.04"
          dependsOn: chef-core
